v<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page }} - Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo-section">
            <div class="logo">
                <i class="fas fa-cube"></i>
                <span>Material Dashboard</span>
            </div>
        </div>

        <nav class="nav-menu">
            <a href="{{ url_for('home') }}" class="nav-item {% if page == 'Dashboard' %}active{% endif %}">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="{{ url_for('todo_page') }}" class="nav-item">
                <i class="fas fa-tasks"></i>
                <span>To-Do Liste</span>
            </a>
            <a href="{{ url_for('empty_page', page='label_2') }}" class="nav-item {% if page == 'label_2' %}active{% endif %}">
                <i class="fas fa-chart-bar"></i>
                <span>Label_2</span>
            </a>
            <a href="{{ url_for('empty_page', page='label_3') }}" class="nav-item {% if page == 'label_3' %}active{% endif %}">
                <i class="fas fa-users"></i>
                <span>Label_3</span>
            </a>
            <a href="{{ url_for('empty_page', page='label_4') }}" class="nav-item {% if page == 'label_4' %}active{% endif %}">
                <i class="fas fa-cog"></i>
                <span>Label_4</span>
            </a>
            <a href="{{ url_for('empty_page', page='label_5') }}" class="nav-item {% if page == 'label_5' %}active{% endif %}">
                <i class="fas fa-bell"></i>
                <span>Label_5</span>
            </a>
            <a href="{{ url_for('empty_page', page='label_6') }}" class="nav-item {% if page == 'label_6' %}active{% endif %}">
                <i class="fas fa-user"></i>
                <span>Label_6</span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>{{ page }}</h1>
                <span class="breadcrumb">Home / {{ page }}</span>
            </div>
            <div class="header-right">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Suchen...">
                </div>
                <div class="notifications-container">
                    <button class="header-btn notifications-btn" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </button>

                    <!-- Notifications Dropdown -->
                    <div class="notifications-dropdown" id="notificationsDropdown">
                        <div class="notifications-header">
                            <h3><i class="fas fa-bell"></i> Benachrichtigungen</h3>
                            <button class="mark-read-btn" onclick="markAllRead()">Alle lesen</button>
                        </div>
                        <div class="notifications-content">
                            <div class="notification-item unread">
                                <div class="notification-icon message">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-header">
                                        <span class="notification-title">Neue Nachricht von John Doe</span>
                                        <span class="notification-time">vor 5 Min</span>
                                    </div>
                                    <div class="notification-text">Neue Projektanfrage eingegangen. Bitte prüfen Sie die Details.</div>
                                </div>
                            </div>

                            <div class="notification-item">
                                <div class="notification-icon info">
                                    <i class="fas fa-calendar"></i>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-header">
                                        <span class="notification-title">Meeting verschoben</span>
                                        <span class="notification-time">vor 1 Std</span>
                                    </div>
                                    <div class="notification-text">Das wöchentliche Meeting wurde auf morgen 14:00 verschoben.</div>
                                </div>
                            </div>

                            <div class="notification-item unread">
                                <div class="notification-icon system">
                                    <i class="fas fa-cogs"></i>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-header">
                                        <span class="notification-title">System Update</span>
                                        <span class="notification-time">vor 2 Std</span>
                                    </div>
                                    <div class="notification-text">Sicherheitsupdate erfolgreich installiert. System läuft stabil.</div>
                                </div>
                            </div>

                            <div class="notification-item">
                                <div class="notification-icon warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-header">
                                        <span class="notification-title">Budget Warnung</span>
                                        <span class="notification-time">gestern</span>
                                    </div>
                                    <div class="notification-text">Monatsbudget zu 90% erreicht. Weitere Ausgaben prüfen.</div>
                                </div>
                            </div>

                            <div class="notification-item">
                                <div class="notification-icon message">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-header">
                                        <span class="notification-title">Bericht verfügbar</span>
                                        <span class="notification-time">gestern</span>
                                    </div>
                                    <div class="notification-text">Die Quartalsberichte sind fertig und warten auf Ihre Freigabe.</div>
                                </div>
                            </div>
                        </div>
                        <div class="notifications-footer">
                            <button class="view-all-btn">Alle Benachrichtigungen anzeigen</button>
                        </div>
                    </div>
                </div>
                <div class="user-menu">
                    <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face&faceindex=1" alt="User Avatar" class="user-avatar">
                    <div class="user-info">
                        <span class="username">{{ username }}</span>
                        <span class="user-status">Online</span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <a href="{{ url_for('logout') }}" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </header>

        <!-- Page Content -->
        <div class="content-area">
            <div class="dashboard-window">
                <div class="window-header">
                    <h2>{{ page }} Content</h2>
                    <div class="window-controls">
                        <button><i class="fas fa-minus"></i></button>
                        <button><i class="fas fa-expand"></i></button>
                        <button><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <div class="window-content">
                    <!-- Standard Content für alle Labels -->
                    <div class="placeholder-content">
                        <i class="fas fa-file-alt"></i>
                        <h3>{{ page }}</h3>
                        <p>Dies ist eine leere Seite für {{ page }}. Fügen Sie hier Ihren Inhalt hinzu.</p>

                        <div class="feature-grid">
                            <div class="feature-item">
                                <i class="fas fa-plus-circle"></i>
                                <h4>Neuen Inhalt hinzufügen</h4>
                                <p>Beginnen Sie mit dem Aufbau Ihrer {{ page }} Seite</p>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-edit"></i>
                                <h4>Bearbeiten</h4>
                                <p>Passen Sie den Inhalt nach Ihren Wünschen an</p>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-save"></i>
                                <h4>Speichern</h4>
                                <p>Speichern Sie Ihre Änderungen automatisch</p>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-share"></i>
                                <h4>Teilen</h4>
                                <p>Teilen Sie Ihre Inhalte mit anderen</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Nachrichten Modal -->
    <div class="messages-modal" id="messagesModal">
        <div class="messages-container">
            <div class="messages-header">
                <h3><i class="fas fa-envelope"></i> Nachrichten Hub</h3>
                <button class="close-btn" onclick="toggleMessages()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="messages-content">
                <div class="message-item">
                    <div class="message-avatar">JD</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender message-unread">John Doe</span>
                            <span class="message-time">vor 5 Min</span>
                        </div>
                        <div class="message-text">Neue Projektanfrage eingegangen. Bitte prüfen Sie die Details.</div>
                    </div>
                </div>

                <div class="message-item">
                    <div class="message-avatar">MS</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">Maria Schmidt</span>
                            <span class="message-time">vor 1 Std</span>
                        </div>
                        <div class="message-text">Das wöchentliche Meeting wurde auf morgen 14:00 verschoben.</div>
                    </div>
                </div>

                <div class="message-item">
                    <div class="message-avatar">SY</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender message-unread">System</span>
                            <span class="message-time">vor 2 Std</span>
                        </div>
                        <div class="message-text">Sicherheitsupdate erfolgreich installiert. System läuft stabil.</div>
                    </div>
                </div>

                <div class="message-item">
                    <div class="message-avatar">TK</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">Thomas Klein</span>
                            <span class="message-time">gestern</span>
                        </div>
                        <div class="message-text">Können wir uns morgen wegen des neuen Budgetplans besprechen?</div>
                    </div>
                </div>

                <div class="message-item">
                    <div class="message-avatar">LM</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">Lisa Müller</span>
                            <span class="message-time">gestern</span>
                        </div>
                        <div class="message-text">Die Quartalsberichte sind fertig und warten auf Ihre Freigabe.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleNotifications() {
            const dropdown = document.getElementById('notificationsDropdown');
            console.log('Button clicked!'); // Debug
            console.log('Dropdown found:', dropdown); // Debug

            if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                dropdown.style.display = 'block';
                setTimeout(() => {
                    dropdown.classList.add('show');
                }, 10);
            } else {
                dropdown.classList.remove('show');
                setTimeout(() => {
                    dropdown.style.display = 'none';
                }, 300);
            }
        }

        function markAllRead() {
            const unreadItems = document.querySelectorAll('.notification-item.unread');
            unreadItems.forEach(item => {
                item.classList.remove('unread');
            });

            // Badge aktualisieren
            const badge = document.querySelector('.badge');
            badge.textContent = '0';
            badge.style.display = 'none';
        }

        // Schließe Dropdown bei Klick außerhalb
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('notificationsDropdown');
            const button = document.querySelector('.notifications-btn');

            if (!dropdown.contains(e.target) && !button.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        // Schließe Modal bei Klick außerhalb entfernt

        // Escape-Taste zum Schließen
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('messagesModal');
                if (modal.classList.contains('show')) {
                    toggleMessages();
                }
            }
        });

        // Simuliere neue Nachrichten (optional)
        function simulateNewMessage() {
            const badge = document.querySelector('.badge');
            let currentCount = parseInt(badge.textContent);
            badge.textContent = currentCount + 1;

            // Animation für neue Nachricht
            badge.style.animation = 'pulse 0.5s ease-in-out';
            setTimeout(() => {
                badge.style.animation = '';
            }, 500);
        }

        // Pulse Animation für Badge
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);

        // ===== TO-DO LIST FUNCTIONALITY =====
        let todos = [];
        let isCompletedCollapsed = false;

        // Lade To-Dos beim Seitenstart (nur für label_1)
        document.addEventListener('DOMContentLoaded', function() {
            const page = '{{ page }}';
            if (page === 'label_1') {
                loadTodos();
                setupTodoEventListeners();
            }
        });

        function setupTodoEventListeners() {
            // Enter-Taste im Input
            const todoInput = document.getElementById('todoInput');
            if (todoInput) {
                todoInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addTodo();
                    }
                });
            }
        }

        async function loadTodos() {
            try {
                const response = await fetch('/api/todos');
                if (response.ok) {
                    todos = await response.json();
                } else {
                    todos = [];
                }
                renderTodos();
            } catch (error) {
                console.log('Fehler beim Laden der To-Dos:', error);
                todos = [];
                renderTodos();
            }
        }

        async function saveTodos() {
            try {
                await fetch('/api/todos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(todos)
                });
            } catch (error) {
                console.log('Fehler beim Speichern der To-Dos:', error);
            }
        }

        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();

            if (text === '') return;

            const newTodo = {
                id: Date.now(),
                text: text,
                completed: false,
                createdAt: new Date().toISOString(),
                completedAt: null
            };

            todos.unshift(newTodo); // Neue Tasks oben
            input.value = '';
            renderTodos();
            saveTodos();
        }

        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                todo.completedAt = todo.completed ? new Date().toISOString() : null;
                renderTodos();
                saveTodos();
            }
        }

        function deleteTodo(id) {
            todos = todos.filter(t => t.id !== id);
            renderTodos();
            saveTodos();
        }

        function toggleCompleted() {
            isCompletedCollapsed = !isCompletedCollapsed;
            const completedList = document.getElementById('completedTodos');
            const toggleIcon = document.getElementById('completedToggle');

            if (isCompletedCollapsed) {
                completedList.style.display = 'none';
                toggleIcon.className = 'fas fa-chevron-right';
            } else {
                completedList.style.display = 'block';
                toggleIcon.className = 'fas fa-chevron-down';
            }
        }

        function renderTodos() {
            const openTodos = todos.filter(t => !t.completed).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            const completedTodos = todos.filter(t => t.completed).sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));

            // Zähler aktualisieren
            document.getElementById('openCount').textContent = openTodos.length;
            document.getElementById('completedCount').textContent = completedTodos.length;

            // Offene To-Dos rendern
            const openContainer = document.getElementById('openTodos');
            openContainer.innerHTML = openTodos.map(todo => createTodoHTML(todo)).join('');

            // Erledigte To-Dos rendern
            const completedContainer = document.getElementById('completedTodos');
            completedContainer.innerHTML = completedTodos.map(todo => createTodoHTML(todo)).join('');
        }

        function createTodoHTML(todo) {
            const createdDate = new Date(todo.createdAt).toLocaleString('de-DE');
            const completedDate = todo.completedAt ? new Date(todo.completedAt).toLocaleString('de-DE') : '';

            return `
                <div class="todo-item ${todo.completed ? 'completed' : ''}" title="Erstellt: ${createdDate}${todo.completedAt ? ', Erledigt: ' + completedDate : ''}">
                    <button class="todo-check-btn ${todo.completed ? 'checked' : ''}" onclick="toggleTodo(${todo.id})">
                        <i class="fas ${todo.completed ? 'fa-check' : 'fa-circle'}"></i>
                    </button>
                    <span class="todo-text">${todo.text}</span>
                    <button class="todo-delete-btn" onclick="deleteTodo(${todo.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
        }
    </script>
        });

        // Simuliere neue Nachrichten (optional)
        function simulateNewMessage() {
            const badge = document.querySelector('.badge');
            let currentCount = parseInt(badge.textContent);
            badge.textContent = currentCount + 1;

            // Animation für neue Nachricht
            badge.style.animation = 'pulse 0.5s ease-in-out';
            setTimeout(() => {
                badge.style.animation = '';
            }, 500);
        }

        // Pulse Animation für Badge
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>